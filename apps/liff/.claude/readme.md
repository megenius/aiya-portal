**บทบาท:**
คุณคือทีมพัฒนาผลิตภัณฑ์ Full-stack ผู้เชี่ยวชาญ ประกอบด้วย UX/UI Designer, Backend API Architect และ Frontend Developer

**เป้าหมาย:**
ออกแบบโซลูชันที่สมบูรณ์สำหรับฟีเจอร์ "แคมเปญภารกิจ (Gamification)" โดยอ้างอิงจากข้อมูลจำเพาะที่ให้ไว้ด้านล่างนี้ **เท่านั้น**

## **แหล่งข้อมูลหลัก (Specification):**

### **ภาพรวม**

โมดูลนี้ถูกออกแบบมาเพื่อสร้างกิจกรรม Gamification โดยเฉพาะ ซึ่งทำงานแยกออกจากระบบคูปองหลัก แต่ยังคงอยู่ภายใต้ผู้ให้บริการ (`pages_liff`) เดียวกัน ประกอบด้วย 6 ตารางหลักที่ทำงานร่วมกันเพื่อสร้างประสบการณ์ที่สมบูรณ์

### **1. User Journey (เส้นทางของผู้ใช้)**

ผมจะใช้ตัวละครสมมติชื่อ **"คุณบี"** เพื่อเล่าเรื่องราวการเข้าร่วมแคมเปญ **"AIYA Fun Fest"** ครับ

**เฟส 1: ค้นพบและลงทะเบียน (Discovery & Registration)**

1.  **เจอแคมเปญ:** คุณบีเปิด LIFF App ของ AIYA และเห็นแบนเนอร์ขนาดใหญ่ของแคมเปญ "AIYA Fun Fest" (รูปภาพมาจาก `campaigns.banner_image`)
2.  **ดูรายละเอียด:** เมื่อคลิกแบนเนอร์ คุณบีจะถูกพาไปยังหน้าแคมเปญ ซึ่งแสดง `title` และ `description` ของแคมเปญ
3.  **ยอมรับเงื่อนไข (PDPA):** ก่อนจะเริ่มเล่น จะมีหน้าให้คุณบีกดยอมรับ PDPA
    - **➡️ ฐานข้อมูลทำงาน:** เมื่อกดยอมรับ ระบบจะสร้างข้อมูลใน **`user_campaign_registrations`** โดยตั้งค่า `has_agreed_pdpa = true`
4.  **กรอกข้อมูลลงทะเบียน:** หลังจากยอมรับ PDPA แล้ว จะปรากฏฟอร์มให้กรอกข้อมูล (ชื่อ-นามสกุล, เบอร์โทร) ซึ่งถูกสร้างขึ้นแบบไดนามิกจากโครงสร้างใน `campaigns.registration_form`
    - **➡️ ฐานข้อมูลทำงาน:** เมื่อกดยืนยัน ระบบจะ **`UPDATE`** ข้อมูลที่กรอกลงใน `registration_data` ของแถวเดิม

**เฟส 2: ทำภารกิจและรับสิทธิ์ (Participation & Reward)**

1.  **เข้าสู่หน้าภารกิจ:** หลังจากลงทะเบียนเสร็จ คุณบีจะเห็นหน้าจอหลักของแคมเปญ ซึ่งประกอบด้วย:
    - **ยอดสิทธิ์คงเหลือ:** ดึงข้อมูลจาก `user_reward_credits.total_earned` (ตอนนี้คือ 0)
    - **รายการภารกิจ:** ดึงข้อมูลภารกิจทั้งหมดจากตาราง **`campaign_missions`** พร้อมแสดงสถานะ "ทำได้ครั้งเดียว" หรือ "ทำซ้ำได้" ตามค่า `frequency`
2.  **ทำภารกิจ "ถ่ายรูปที่บูท" (ทำได้ครั้งเดียว):**
    - คุณบีอ่านรายละเอียดภารกิจ, ไปถ่ายรูป, แล้วกลับมาที่หน้าแคมเปญ
    - เธอจะเห็น "ฟอร์ม" ที่สร้างขึ้นตามโครงสร้างใน `campaign_missions.mission_data` ซึ่งมีช่องให้อัปโหลดรูปภาพ
    - คุณบีอัปโหลดรูปภาพหลักฐาน
    - **➡️ ฐานข้อมูลทำงาน (ทันที):**
      1.  สร้างข้อมูลใหม่ใน **`user_mission_submissions`** เพื่อบันทึกว่าคุณบีส่งหลักฐานแล้ว
      2.  สร้างประวัติการได้แต้มใน **`reward_credit_transactions`** (`+1 สิทธิ์`)
      3.  อัปเดตยอดรวมใน **`user_reward_credits`** (ยอดรวมกลายเป็น 1)
3.  **ทำภารกิจ "ซื้อสินค้า" (ทำซ้ำได้):**
    - คุณบีเห็นภารกิจ "ซื้อเครื่อง 1 เครื่อง รับ 10 สิทธิ์" ซึ่งมีป้ายกำกับว่า "ทำซ้ำได้"
    - เธอทำการซื้อสินค้าและอัปโหลดใบเสร็จพร้อมรูปโพสต์
    - **➡️ ฐานข้อมูลทำงาน:** ระบบทำงานเหมือนเดิม ยอดสิทธิ์ของคุณบีเพิ่มขึ้นเป็น **11 สิทธิ์**
    - ในวันต่อมา คุณบีซื้อสินค้าอีกเครื่องและ **ส่งหลักฐานสำหรับภารกิจเดิมอีกครั้ง**
    - **➡️ ฐานข้อมูลทำงาน:** ระบบจะสร้างแถวข้อมูลใหม่ใน **`user_mission_submissions`** สำหรับการส่งครั้งที่สองนี้ และอัปเดตยอดสิทธิ์ของคุณบีเป็น **21 สิทธิ์**
4.  **ได้รับสิทธิ์ทันที:** หน้าจอของคุณบีจะแสดงผลว่า "ทำภารกิจสำเร็จ!" และยอดสิทธิ์จะอัปเดตเป็นยอดรวมล่าสุดทันที

**เฟส 3: หลังจบแคมเปญ (Post-Campaign)**

1.  **จับรางวัล:** ทีมงานทำการสุ่มผู้โชคดีจากข้อมูลใน `user_reward_credits`
2.  **ผู้โชคดีคือ "คุณบี"!**
3.  **ตรวจสอบหลักฐาน:** ทีมงานจะเข้าไปที่ระบบหลังบ้านเพื่อตรวจสอบหลักฐานทั้งหมดที่คุณบีเคยส่งมาในตาราง **`user_mission_submissions`**
4.  **ยืนยันและมอบรางวัล:** เมื่อตรวจสอบว่าหลักฐานถูกต้อง ทีมงานก็จะประกาศผลและติดต่อคุณบีเพื่อมอบรางวัลต่อไป

### **2. คำอธิบายตารางที่เกี่ยวข้อง**

- **`campaigns` (ตารางแคมเปญ):**
  - **หน้าที่:** เป็น "แฟ้มหลัก" ของกิจกรรมทั้งหมด ใช้เก็บข้อมูลภาพรวม เช่น ชื่อ, ระยะเวลา, รูปภาพโปรโมต, และที่สำคัญคือ **`registration_form`** ที่ใช้สร้างฟอร์มลงทะเบียน
- **`campaign_missions` (ตารางภารกิจ):**
  - **หน้าที่:** เป็น "รายการสิ่งที่ต้องทำ" ที่อยู่ในแฟ้มแคมเปญ ใช้กำหนดว่ามีภารกิจอะไรบ้าง, ทำสำเร็จแล้วจะได้กี่สิทธิ์ (`reward_credits`), และสร้างฟอร์มสำหรับส่งหลักฐาน (`mission_data`)
  - **หัวใจสำคัญ:** คอลัมน์ **`frequency`** ('ONCE' หรือ 'MULTIPLE') เป็นตัวกำหนดว่าผู้ใช้สามารถทำภารกิจนี้ซ้ำเพื่อรับสิทธิ์เพิ่มได้หรือไม่
- **`user_campaign_registrations` (ตารางการลงทะเบียน):**
  - **หน้าที่:** เป็น "สมุดลงชื่อ" ใช้บันทึกว่าใครบ้างที่เข้าร่วมแคมเปญนี้, ได้ยอมรับเงื่อนไข (PDPA) แล้วหรือยัง, และเก็บข้อมูลที่ผู้ใช้กรอกผ่านฟอร์มลงทะเบียน
- **`user_mission_submissions` (ตารางการส่งหลักฐาน):**
  - **หน้าที่:** เป็น "กล่องเก็บหลักฐาน" ของผู้ใช้แต่ละคน สำหรับภารกิจที่ทำซ้ำได้ (`frequency: 'MULTIPLE'`) จะมีการสร้างแถวข้อมูลใหม่ทุกครั้งที่ผู้ใช้ส่งหลักฐานเข้ามา
- **`user_reward_credits` (ตารางกระเป๋าเก็บสิทธิ์):**
  - **หน้าที่:** เป็น "กระเป๋าเงิน" ที่เก็บ **ยอดรวมล่าสุด** ของสิทธิ์ที่ผู้ใช้แต่ละคนสะสมได้ในแคมเปญนั้นๆ เพื่อให้ดึงไปแสดงผลได้อย่างรวดเร็ว
- **`reward_credit_transactions` (ตารางประวัติการได้สิทธิ์):**
  - **หน้าที่:** เป็น "สมุดบัญชี" ที่บันทึกทุกการเคลื่อนไหวของสิทธิ์ ทำให้สามารถตรวจสอบย้อนหลังได้ว่าผู้ใช้ได้รับสิทธิ์จากอะไรบ้าง และเมื่อไหร่

### **3. ตัวอย่างข้อมูลในตาราง (JSON Data Examples)**

นี่คือหน้าตาของข้อมูลที่จะถูกบันทึกลงในฐานข้อมูลตาม Journey ของคุณบีครับ

- **ตัวอย่างโครงสร้างฟอร์มลงทะเบียน:**
  - **ตาราง:** `campaigns`
  - **คอลัมน์ `registration_form` (JSON):**
    ```json
    {
      "fields": [
        {
          "name": "first_name",
          "label": { "th": "ชื่อจริง", "en": "First Name" },
          "type": "text",
          "required": true
        },
        {
          "name": "phone",
          "label": { "th": "เบอร์โทรศัพท์", "en": "Phone Number" },
          "type": "tel",
          "required": true
        }
      ]
    }
    ```
- **เมื่อคุณบีลงทะเบียนเข้าร่วมแคมเปญ:**
  - **ตาราง:** `user_campaign_registrations`
  - **คอลัมน์ `registration_data` (JSON):**
    ```json
    {
      "first_name": "สมหญิง",
      "phone": "0812345678"
    }
    ```
- **เมื่อคุณบีทำภารกิจ "ซื้อเครื่องในวันงาน" สำเร็จ:**
  - **ตาราง:** `user_mission_submissions`
  - **คอลัมน์ `submission_data` (JSON):**
    ```json
    {
      "receipt_image": "f1g2h3j4-k5l6-...",
      "post_screenshot": "m1n2b3v4-c5x6-..."
    }
    ```

---

**สิ่งที่ต้องการ (Deliverables):**

**ส่วนที่ 1: การออกแบบ UX/UI**
จาก User Journey ที่อธิบายไว้ในเอกสาร โปรดให้ข้อมูลต่อไปนี้:

1.  **ลำดับหน้าจอ (Screen Flow):** อธิบายหน้าจอทั้งหมดที่ผู้ใช้จะโต้ตอบ ตั้งแต่การเจอแบนเนอร์, ยอมรับ PDPA, กรอกข้อมูล, ดูรายการภารกิจ, และส่งหลักฐาน
2.  **องค์ประกอบหลักในแต่ละหน้า:** สำหรับแต่ละหน้าจอ ให้ระบุ UI Component ที่จำเป็น (เช่น ปุ่ม, ข้อความ, รูปภาพ, ฟอร์ม)
3.  **แผนภาพ User Flow:** สร้างแผนภาพ Sequence Diagram แบบง่ายๆ (ใช้ Mermaid หรือ Text) เพื่อแสดงเส้นทางของผู้ใช้

**ส่วนที่ 2: การออกแบบ Backend API**
จากตารางฐานข้อมูลและ User Journey ให้ออกแบบ RESTful API Endpoint ที่จำเป็น สำหรับแต่ละ Endpoint โปรดระบุ:

1.  **HTTP Method & URL Path:** (เช่น `POST /api/campaigns/{campaign_id}/register`)
2.  **คำอธิบาย:** อธิบายสั้นๆ ว่า Endpoint ทำหน้าที่อะไร
3.  **Request Body (ถ้ามี):** ตัวอย่าง JSON payload
4.  **Successful Response Body (ถ้ามี):** ตัวอย่าง JSON response
5.  **Authentication:** ระบุว่าต้องมีการยืนยันตัวตนผู้ใช้หรือไม่

**ข้อกำหนด:**

- การออกแบบทั้งหมดต้องยึดตามตรรกะ, ชื่อตาราง, และชื่อฟิลด์ที่ระบุไว้ใน "แหล่งข้อมูลหลัก" อย่างเคร่งครัด
- แพลตฟอร์มเป้าหมายคือ LINE Front-end Framework (LIFF) Application
- ใช้ Markdown เพื่อการจัดรูปแบบที่ชัดเจน
